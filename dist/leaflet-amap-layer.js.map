{"version":3,"file":"leaflet-amap-layer.js","sources":["../src/Leaflet.CustomLayer.js","../src/AmapLayer.js"],"sourcesContent":["/*!\n * Leaflet.CustomLayer.js v2.1.0\n * \n * Copyright (c) 2019-present Derek Li\n * Released under the MIT License - https://choosealicense.com/licenses/mit/\n * \n * https://github.com/iDerekLi/Leaflet.CustomLayer\n */\n!function(t, e) {\n    \"object\" == typeof exports && \"undefined\" != typeof module ? e(exports, require(\"leaflet\")) : \"function\" == typeof define && define.amd ? define([ \"exports\", \"leaflet\" ], e) : e(((t = t || self).Leaflet = t.Leaflet || {}, \n    t.Leaflet.CustomLayer = {}), t.L);\n}(this, function(t, e) {\n    \"use strict\";\n    /**\n   * @class CustomLayer\n   * @inherits Layer\n   *\n   * Leaflet overlay plugin: L.CustomLayer - fully custom Layer.\n   */\n    var i = (e = e && e.hasOwnProperty(\"default\") ? e[\"default\"] : e).Layer.extend({\n        // CustomLayer options\n        options: {\n            // How much to extend the clip area around the map view (relative to its size)\n            // e.g. 0.1 would be 10% of map view in each direction\n            padding: 0,\n            // How much to extend click tolerance round a path/object on the map\n            tolerance: 0,\n            // The DomElement object to display\n            container: null,\n            // The opacity of the layer, [0,1]\n            opacity: 1,\n            // Is the layer visible\n            visible: !0,\n            // The zIndex of the layer\n            zIndex: undefined,\n            // Set the visibility min zoom level\n            minZoom: 0,\n            // Set the visibility max zoom level\n            maxZoom: 18\n        },\n        initialize: function initialize(t) {\n            e.setOptions(this, t), \n            /* Built-in Date */\n            e.stamp(this), this._map = undefined, this._container = undefined, this._bounds = undefined, \n            this._center = undefined, this._zoom = undefined, this._padding = undefined;\n        },\n        /* Built-in Lifecycle */\n        beforeAdd: function beforeAdd() {\n            this._zoomVisible = !0;\n        },\n        getEvents: function getEvents() {\n            // Layer trigger priority\n            // move: movestart -> move -> moveend\n            // zoom: zoomstart -> movestart -> zoomanim -> zoom -> move -> zoomend -> moveend\n            // resize: move -> resize -> moveend\n            var t = {\n                viewreset: this._onLayerViewReset,\n                zoom: this._onLayerZoom,\n                moveend: this._onLayerMoveEnd,\n                zoomend: this._onLayerZoomEnd\n            };\n            return this._zoomAnimated && (t.zoomanim = this._onLayerAnimZoom), t;\n        },\n        onAdd: function onAdd() {\n            if (this.fire(\"layer-beforemount\"), // Lifecycle beforeMount\n            this._container || this._initContainer(), this.setOpacity(this.options.opacity), \n            window.isNaN(this.options.zIndex)) switch (this._container.tagName) {\n              // http://www.w3.org/1999/xhtml\n                case \"CANVAS\":\n                this.setZIndex(100);\n                break;\n\n // http://www.w3.org/2000/svg\n                              case \"svg\":\n                this.setZIndex(200);\n                break;\n\n              default:\n                this.setZIndex(100);\n            } else this.setZIndex(this.options.zIndex);\n            this.getPane().appendChild(this._container), this._onZoomVisible(), this.fire(\"layer-mounted\"), \n            // Lifecycle mounted\n            this._update();\n        },\n        onRemove: function onRemove() {\n            this.fire(\"layer-beforedestroy\"), // Lifecycle beforeDestroy\n            this._destroyContainer(), this.fire(\"layer-destroyed\");\n        },\n        /* Built-in Events */\n        _onLayerViewReset: function _onLayerViewReset() {\n            this._reset();\n        },\n        _onLayerAnimZoom: function _onLayerAnimZoom(t) {\n            this._updateTransform(t.center, t.zoom);\n        },\n        _onLayerZoom: function _onLayerZoom() {\n            this._updateTransform(this._map.getCenter(), this._map.getZoom());\n        },\n        _onLayerZoomEnd: function _onLayerZoomEnd() {},\n        _onLayerMoveEnd: function _onLayerMoveEnd() {\n            this._isZoomVisible() ? this._update() : this._zoomHide();\n        },\n        _onZoomVisible: function _onZoomVisible() {\n            this._isZoomVisible() ? this._zoomShow() : this._zoomHide();\n        },\n        /* Built-in Methods */\n        _initContainer: function _initContainer() {\n            var t = this._container = this.options.container;\n            e.DomUtil.addClass(t, \"leaflet-layer\"), this._zoomAnimated && e.DomUtil.addClass(this._container, \"leaflet-zoom-animated\");\n        },\n        _destroyContainer: function _destroyContainer() {\n            e.DomUtil.remove(this._container), delete this._container;\n        },\n        _isZoomVisible: function _isZoomVisible() {\n            var t = this.options.minZoom, e = this.options.maxZoom, i = this._map.getZoom();\n            return i >= t && i <= e;\n        },\n        _zoomShow: function _zoomShow() {\n            this._zoomVisible || (this._zoomVisible = !0, this._map.off({\n                zoomend: this._onZoomVisible\n            }, this), this.options.visible && (this._map.on(this.getEvents(), this), this.getContainer().style.display = \"\"));\n        },\n        _zoomHide: function _zoomHide() {\n            this._zoomVisible && (this._zoomVisible = !1, this._map.off(this.getEvents(), this), \n            this._map.on({\n                zoomend: this._onZoomVisible\n            }, this), this.getContainer().style.display = \"none\");\n        },\n        _updateTransform: function _updateTransform(t, i) {\n            var o = this._map.getZoomScale(i, this._zoom), n = e.DomUtil.getPosition(this._container), s = this._map.getSize().multiplyBy(.5 + this.options.padding), a = this._map.project(this._center, i), r = this._map.project(t, i).subtract(a), h = s.multiplyBy(-o).add(n).add(s).subtract(r);\n            e.Browser.any3d ? e.DomUtil.setTransform(this._container, h, o) : e.DomUtil.setPosition(this._container, h);\n        },\n        _update: function _update() {\n            if (!this._map._animatingZoom || !this._bounds) {\n                this.__update();\n                var t = this._bounds, i = this._container;\n                e.DomUtil.setPosition(i, t.min), this.fire(\"layer-render\");\n            }\n        },\n        __update: function __update() {\n            // Update pixel bounds of renderer container (for positioning/sizing/clipping later)\n            // Subclasses are responsible of firing the 'update' event.\n            var t = this.options.padding, i = this._map.getSize(), o = this._map.containerPointToLayerPoint(i.multiplyBy(-t));\n            this._padding = i.multiplyBy(t), // this._bounds = new L.Bounds(\n            //   min.round(),\n            //   min.add(size.multiplyBy(1 + p * 2)).round()\n            // );\n            this._bounds = new e.Bounds(o, o.add(i.multiplyBy(1 + 2 * t))), this._center = this._map.getCenter(), \n            this._zoom = this._map.getZoom();\n        },\n        _reset: function _reset() {\n            this._update(), this._updateTransform(this._center, this._zoom);\n        },\n        /**\n     * API\n     */\n        /* Methods */\n        getContainer: function getContainer() {\n            return this._container;\n        },\n        setContainer: function setContainer(t) {\n            var e = this.getContainer(), i = e.parentNode;\n            if (delete this._container, this.options.container = t, this._container || this._initContainer(), \n            this.setOpacity(this.options.opacity), window.isNaN(this.options.zIndex)) switch (this._container.tagName) {\n              case \"CANVAS\":\n                this.setZIndex(100);\n                break;\n\n              case \"svg\":\n                this.setZIndex(200);\n                break;\n\n              default:\n                this.setZIndex(100);\n            } else this.setZIndex(this.options.zIndex);\n            return i ? i.replaceChild(t, e) : this.getPane().appendChild(t), this._update(), \n            this;\n        },\n        getOpacity: function getOpacity() {\n            return this.options.opacity;\n        },\n        setOpacity: function setOpacity(t) {\n            return this.getContainer().style.opacity = this.options.opacity = 1 * t, this;\n        },\n        getZIndex: function getZIndex() {\n            return this.options.zIndex;\n        },\n        setZIndex: function setZIndex(t) {\n            return this.getContainer().style.zIndex = this.options.zIndex = 1 * t, this;\n        },\n        show: function show() {\n            if (!this.options.visible) {\n                if (this.options.visible = !0, this._isZoomVisible()) return this._map.on(this.getEvents(), this), \n                this.getContainer().style.display = \"\", this._update(), this;\n                this._zoomHide();\n            }\n        },\n        hide: function hide() {\n            if (this.options.visible) return this.options.visible = !1, this._zoomHide(), this._map.off(this.getEvents(), this), \n            this.getContainer().style.display = \"none\", this;\n        },\n        setFullLayerBounds: function setFullLayerBounds() {\n            var t = this.getContainer(), i = this._bounds.getSize(), o = this._padding;\n            switch (t.tagName) {\n              case \"CANVAS\":\n                var n = e.Browser.retina ? 2 : 1;\n                t.width = n * i.x, t.height = n * i.y, t.style.width = i.x + \"px\", t.style.height = i.y + \"px\";\n                var s = t.getContext(\"2d\");\n                return e.Browser.retina && s.scale(n, n), s.translate(o.x, o.y), {\n                    container: t,\n                    ctx: s,\n                    dpr: n\n                };\n\n              case \"svg\":\n                return t.setAttribute(\"width\", i.x), t.setAttribute(\"height\", i.y), t.style.width = i.x + \"px\", \n                t.style.height = i.y + \"px\", t.setAttribute(\"viewBox\", \"\".concat(-o.x, \" \").concat(-o.y, \" \").concat(i.x, \" \").concat(i.y)), \n                {\n                    container: t\n                };\n\n              case \"DIV\":\n                return t.style.boxSizing = \"content-box\", t.style.width = i.x - o.x + \"px\", t.style.height = i.y - o.y + \"px\", \n                t.style.padding = \"\".concat(o.y, \"px \").concat(o.x, \"px\"), {\n                    container: t\n                };\n\n              default:\n                return t.setAttribute(\"width\", i.x), t.setAttribute(\"height\", i.y), t.style.width = i.x + \"px\", \n                t.style.height = i.y + \"px\", {\n                    container: t\n                };\n            }\n        }\n        /* Events */\n        // on(\"layer-beforemount\", fn);\n        // on(\"layer-mounted\", fn);\n        // on(\"layer-render\", fn);\n        // on(\"layer-beforedestroy\", fn);\n        // on(\"layer-destroyed\", fn);\n        });\n // @factory L.customLayer(options?: Renderer options)\n    // Creates a CustomLayer renderer with the given options.\n        function customLayer(t) {\n        return e.customLayer ? new i(t) : null;\n    }\n    /**\n   * Plugin Props\n   */    e.CustomLayer = i, e.customLayer = customLayer, t.CustomLayer = i, t.customLayer = customLayer, \n    t[\"default\"] = customLayer, Object.defineProperty(t, \"__esModule\", {\n        value: !0\n    });\n});\n//# sourceMappingURL=Leaflet.CustomLayer.js.map\n","import L from \"leaflet\";\nimport \"./Leaflet.CustomLayer.js\";\nimport AMapLoader from \"@amap/amap-jsapi-loader\";\n\n/**\n * 高德地图内置样式\n */\nconst AMAP_STYLES = {\n  /** 标准 */\n  normal: \"amap://styles/normal\",\n  /** 幻影黑 */\n  dark: \"amap://styles/dark\",\n  /** 月光银 */\n  light: \"amap://styles/light\",\n  /** 远山黛 */\n  whitesmoke: \"amap://styles/whitesmoke\",\n  /** 草色青 */\n  fresh: \"amap://styles/fresh\",\n  /** 雅士灰 */\n  grey: \"amap://styles/grey\",\n  /** 涂鸦 */\n  graffiti: \"amap://styles/graffiti\",\n  /** 马卡龙 */\n  macaron: \"amap://styles/macaron\",\n  /** 靛青蓝 */\n  blue: \"amap://styles/blue\",\n  /** 极夜蓝 */\n  darkblue: \"amap://styles/darkblue\",\n  /** 酱籽 */\n  wine: \"amap://styles/wine\",\n};\n\n/**\n * 默认配置\n */\nconst DEFAULT_CONFIG = {\n  minZoom: 3,\n  maxZoom: 20,\n  opacity: 1,\n  visible: true,\n  zIndex: 100,\n  apiKey: \"\",\n  securityConfig: {\n    securityJsCode: \"\",\n  },\n  amapConfig: {\n    zoomEnable: true,\n    dragEnable: true,\n    resizeEnable: false,\n    animateEnable: false,\n    jogEnable: false,\n    mapStyle: \"amap://styles/whitesmoke\",\n  },\n};\n\n/**\n * 高德地图图层类\n * 基于 Leaflet.CustomLayer 封装高德地图集成\n */\nclass AmapLayer {\n  constructor(options = {}) {\n    this.map = null;\n    this.customLayer = null;\n    this.amapInstance = null;\n    this.amapContainer = null;\n    this.isLoaded = false;\n    this.resizeHandler = null;\n    this.options = Object.assign({}, DEFAULT_CONFIG, options);\n  }\n\n  /**\n   * 添加到地图\n   * @param map Leaflet地图实例\n   * @param center 地图中心点 [lat, lng]\n   * @param zoom 初始缩放级别\n   */\n  async addTo(map, center, zoom) {\n    if (this.isLoaded) {\n      console.warn(\"AmapLayer is already loaded\");\n      return;\n    }\n\n    try {\n      this.map = map;\n      await this.loadAmapSDK();\n      this.createAmapContainer();\n      this.initCustomLayer();\n      this.initAmap(center, zoom);\n      this.setupEventListeners();\n      this.isLoaded = true;\n    } catch (error) {\n      console.error(\"Failed to add AmapLayer:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * 加载高德地图SDK\n   */\n  async loadAmapSDK() {\n    try {\n      // 如果已经加载过，直接返回\n      if (window.AMap) {\n        return;\n      }\n\n      // 设置安全配置\n      window._AMapSecurityConfig = this.options.securityConfig;\n\n      // 使用 npm 包加载高德地图JS API\n      await AMapLoader.load({\n        key: this.options.apiKey,\n        version: \"2.0\",\n        plugins: [],\n      });\n    } catch (error) {\n      console.error(\"高德地图 SDK 加载失败:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * 创建高德地图容器\n   */\n  createAmapContainer() {\n    this.amapContainer = document.createElement(\"div\");\n    this.amapContainer.id = `amap-container-${Date.now()}`;\n\n    // 获取 Leaflet 地图容器的实际尺寸\n    const mapContainer = this.map?.getContainer();\n    if (!mapContainer) {\n      throw new Error(\"Map container not found\");\n    }\n\n    const containerRect = mapContainer.getBoundingClientRect();\n    const width = containerRect.width;\n    const height = containerRect.height;\n\n    // 设置容器样式，确保尺寸与 Leaflet 地图容器一致\n    Object.assign(this.amapContainer.style, {\n      position: \"absolute\",\n      width: width + \"px\",\n      height: height + \"px\",\n      pointerEvents: \"none\",\n      zIndex: \"-1\", // 确保在地图下层但可见\n    });\n\n    // 先添加到 body\n    document.body.appendChild(this.amapContainer);\n\n    // 创建窗口大小变化处理器\n    this.resizeHandler = () => {\n      if (this.amapContainer && this.map) {\n        const mapContainer = this.map.getContainer();\n        if (mapContainer) {\n          const rect = mapContainer.getBoundingClientRect();\n\n          // 更新容器位置和尺寸\n          Object.assign(this.amapContainer.style, {\n            width: rect.width + \"px\",\n            height: rect.height + \"px\",\n          });\n\n          // 如果高德地图实例存在，重新调整大小\n          if (this.amapInstance) {\n            this.amapInstance.getSize();\n            this.amapInstance.setFitView();\n          }\n        }\n      }\n    };\n\n    // 监听窗口大小变化和地图移动\n    window.addEventListener(\"resize\", this.resizeHandler);\n\n    // 确保容器有正确的尺寸\n    setTimeout(() => {\n      if (this.resizeHandler) {\n        this.resizeHandler();\n      }\n    }, 0);\n  }\n\n  /**\n   * 初始化自定义图层\n   */\n  initCustomLayer() {\n    if (!this.amapContainer || !L.customLayer) {\n      throw new Error(\"Custom layer not available or container not created\");\n    }\n\n    this.customLayer = L.customLayer({\n      container: this.amapContainer,\n      minZoom: this.options.minZoom,\n      maxZoom: this.options.maxZoom,\n      opacity: this.options.opacity,\n      visible: this.options.visible,\n      zIndex: this.options.zIndex,\n    });\n\n    this.setupCustomLayerEvents();\n  }\n\n  /**\n   * 设置自定义图层事件\n   */\n  setupCustomLayerEvents() {\n    if (!this.customLayer) return;\n\n    this.customLayer.on(\"layer-render\", (e) => {\n      if (this.amapInstance && e.target._zoom && e.target._center) {\n        const zoom = e.target._zoom;\n        const center = [e.target._center.lng, e.target._center.lat];\n        this.amapInstance.setZoomAndCenter(zoom, center, true);\n      }\n    });\n\n    this.customLayer.on(\"layer-mounted\", () => {\n      // console.log('AmapLayer mounted')\n    });\n\n    this.customLayer.on(\"layer-destroyed\", () => {\n      // console.log('AmapLayer destroyed')\n    });\n  }\n\n  /**\n   * 初始化高德地图实例\n   */\n  initAmap(center, zoom) {\n    if (!window.AMap || !this.amapContainer) {\n      throw new Error(\"AMap SDK not loaded or container not available\");\n    }\n\n    this.options.amapConfig = Object.assign(\n      {},\n      DEFAULT_CONFIG.amapConfig,\n      this.options.amapConfig\n    );\n    // 设置地图样式\n    if (this.options.amapConfig?.mapStyle) {\n      this.options.amapConfig.mapStyle = this.convertMapStyleName(\n        this.options.amapConfig.mapStyle\n      );\n    }\n    this.amapInstance = new window.AMap.Map(this.amapContainer.id, {\n      ...this.options.amapConfig,\n      resizeEnable: false,\n      viewMode: \"2D\",\n    });\n\n    // 设置地图中心点和缩放级别\n    const position = new window.AMap.LngLat(center[1], center[0]);\n    this.amapInstance.setCenter(position);\n    this.amapInstance.setZoom(zoom);\n\n    // 添加自定义图层到地图\n    this.customLayer.addTo(this.map);\n  }\n\n  /**\n   * 设置事件监听器\n   */\n  setupEventListeners() {\n    // 可以在这里添加其他事件监听器\n  }\n\n  /**\n   * 设置图层可见性\n   */\n  setVisible(visible) {\n    if (this.customLayer) {\n      if (visible) {\n        this.customLayer.show();\n      } else {\n        this.customLayer.hide();\n      }\n    }\n  }\n\n  /**\n   * 设置图层透明度\n   */\n  setOpacity(opacity) {\n    if (this.customLayer) {\n      this.customLayer.setOpacity(opacity);\n    }\n  }\n\n  convertMapStyleName(style) {\n    return style in AMAP_STYLES ? AMAP_STYLES[style] : style;\n  }\n\n  /**\n   * 设置高德地图样式\n   * @param style 地图样式，可以是内置样式名或自定义样式URL\n   */\n  setMapStyle(style) {\n    if (this.amapInstance) {\n      // 检查是否为内置样式名称\n      const styleUrl = this.convertMapStyleName(style);\n\n      if (styleUrl) {\n        this.amapInstance.setMapStyle(styleUrl);\n        // 同时更新配置中的样式\n        if (this.options.amapConfig) {\n          this.options.amapConfig.mapStyle = style;\n        }\n      }\n    }\n  }\n\n  /**\n   * 获取当前地图样式\n   */\n  getMapStyle() {\n    return this.options.amapConfig?.mapStyle;\n  }\n\n  /**\n   * 获取所有可用的内置样式\n   */\n  getAvailableStyles() {\n    return AMAP_STYLES;\n  }\n\n  /**\n   * 设置图层z-index\n   */\n  setZIndex(zIndex) {\n    if (this.customLayer) {\n      this.customLayer.setZIndex(zIndex);\n    }\n  }\n\n  /**\n   * 获取高德地图实例\n   */\n  getAmapInstance() {\n    return this.amapInstance;\n  }\n\n  /**\n   * 获取自定义图层实例\n   */\n  getCustomLayer() {\n    return this.customLayer;\n  }\n\n  /**\n   * 销毁图层\n   */\n  destroy() {\n    if (this.customLayer) {\n      this.customLayer.remove();\n      this.customLayer = null;\n    }\n\n    if (this.amapInstance) {\n      this.amapInstance.destroy();\n      this.amapInstance = null;\n    }\n\n    // 移除事件监听器\n    if (this.resizeHandler) {\n      window.removeEventListener(\"resize\", this.resizeHandler);\n\n      // 移除地图事件监听器\n      if (this.map) {\n        this.map.off(\"move\", this.resizeHandler);\n        this.map.off(\"zoom\", this.resizeHandler);\n      }\n\n      this.resizeHandler = null;\n    }\n\n    if (this.amapContainer && this.amapContainer.parentNode) {\n      this.amapContainer.parentNode.removeChild(this.amapContainer);\n      this.amapContainer = null;\n    }\n\n    this.map = null;\n    this.isLoaded = false;\n  }\n\n  /**\n   * 检查图层是否已加载\n   */\n  isLayerLoaded() {\n    return this.isLoaded;\n  }\n}\n\n/**\n * 创建高德地图图层的工厂函数\n */\nfunction createAmapLayer(options) {\n  return new AmapLayer(options);\n}\n\nexport { AmapLayer, createAmapLayer, AMAP_STYLES };\n"],"names":["t","e","i","hasOwnProperty","Layer","extend","options","padding","tolerance","container","opacity","visible","zIndex","undefined","minZoom","maxZoom","initialize","setOptions","this","stamp","_map","_container","_bounds","_center","_zoom","_padding","beforeAdd","_zoomVisible","getEvents","viewreset","_onLayerViewReset","zoom","_onLayerZoom","moveend","_onLayerMoveEnd","zoomend","_onLayerZoomEnd","_zoomAnimated","zoomanim","_onLayerAnimZoom","onAdd","fire","_initContainer","setOpacity","window","isNaN","tagName","setZIndex","getPane","appendChild","_onZoomVisible","_update","onRemove","_destroyContainer","_reset","_updateTransform","center","getCenter","getZoom","_isZoomVisible","_zoomHide","_zoomShow","DomUtil","addClass","remove","off","on","getContainer","style","display","o","getZoomScale","n","getPosition","s","getSize","multiplyBy","a","project","r","subtract","h","add","Browser","any3d","setTransform","setPosition","_animatingZoom","__update","min","containerPointToLayerPoint","Bounds","setContainer","parentNode","replaceChild","getOpacity","getZIndex","show","hide","setFullLayerBounds","retina","width","x","height","y","getContext","scale","translate","ctx","dpr","setAttribute","concat","boxSizing","customLayer","CustomLayer","Object","defineProperty","value","require$$0","AMAP_STYLES","normal","dark","light","whitesmoke","fresh","grey","graffiti","macaron","blue","darkblue","wine","DEFAULT_CONFIG","apiKey","securityConfig","securityJsCode","amapConfig","zoomEnable","dragEnable","resizeEnable","animateEnable","jogEnable","mapStyle","AmapLayer","constructor","map","amapInstance","amapContainer","isLoaded","resizeHandler","assign","addTo","console","warn","loadAmapSDK","createAmapContainer","initCustomLayer","initAmap","setupEventListeners","error","AMap","_AMapSecurityConfig","AMapLoader","load","key","version","plugins","document","createElement","id","Date","now","mapContainer","Error","containerRect","getBoundingClientRect","position","pointerEvents","body","rect","setFitView","addEventListener","setTimeout","L","setupCustomLayerEvents","target","lng","lat","setZoomAndCenter","convertMapStyleName","Map","viewMode","LngLat","setCenter","setZoom","setVisible","setMapStyle","styleUrl","getMapStyle","getAvailableStyles","getAmapInstance","getCustomLayer","destroy","removeEventListener","removeChild","isLayerLoaded"],"mappings":"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"}